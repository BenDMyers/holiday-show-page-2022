---
import * as prismicH from '@prismicio/helpers'
import { Image } from '@astrojs/image/components'

import { getHomepage } from '../lib/prismicio'

import Present from '../../public/images/header_elements/present.png'
import Bell from '../../public/images/header_elements/bell.png'
import Cursor from '../../public/images/header_elements/cursor.png'
import Hat from '../../public/images/header_elements/hat.png'
import Keyboard from '../../public/images/header_elements/keyboard.png'
import Sock from '../../public/images/header_elements/sock.png'

import Layout from '../layouts/Layout.astro'
import SliceZone from '../components/SliceZone.astro'
import HolidaySnowtacularLogo from '../components/HolidaySnowtacularLogo.astro'
import RegistrationButton from '../components/RegistrationButton.astro'

const page = await getHomepage()
const {
	body,
	title,
	buttonText,
	ctaDescription,
	heroEyebrow,
	metadescription,
	metatitle,
	ogImage,
	slices
} = page.data
const bodyHTML = prismicH.asHTML(body)
---

<Layout title='Holiday Snowtacular - Web Dev Charity Fundraiser'>
	<main class='grid-container'>
		<section class='hero'>
			<div class='hero-column'>
				<div class='kicker'>
					{
						heroEyebrow.map((item, i) => (
							<>
								{i > 0 ? <span class='spacer'> | </span> : ''}

								<span>{item.text}</span>
							</>
						))
					}
				</div>

				<h1 class='visually-hidden'>Holiday Snowtacular</h1>
				<HolidaySnowtacularLogo />

				<div class='body-html'>
					<Fragment set:html='bodyHTML' />
				</div>

				<div class='cta'>
					<p class='cta-description'>{ctaDescription}</p>
					<RegistrationButton>
						{buttonText}
						<span class='icon'>
							<svg viewBox='0 0 17 16' fill='none' role='presentation'>
								<path
									fill='#fff'
									d='M8 14.9a1 1 0 0 1-.3-.7c0-.3.1-.5.3-.7l4.9-5H1.7a1 1 0 0 1-.7-.2 1 1 0 0 1-.3-.7c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3H13l-5-5a1 1 0 0 1-.2-.6c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3L16 6.9l.2.3a1.2 1.2 0 0 1 0 .8s0 .2-.2.3l-6.6 6.6a1 1 0 0 1-.7.3 1 1 0 0 1-.7-.3Z'
								></path>
							</svg>
						</span>
					</RegistrationButton>
				</div>
			</div>
			<div class='hero-column header-composition'>
				<Image src={Present} class='present' alt='' height={306} />
				<Image src={Bell} class='bell' alt='' height={120} />
				<Image src={Cursor} class='cursor' alt='' height={125} />
				<Image src={Hat} class='hat' alt='' height={113} />
				<Image src={Keyboard} class='keyboard' alt='' height={170} />
				<Image src={Sock} class='sock' alt='' height={190} />
			</div>
		</section>
		<div class='slice-container'>
			<SliceZone slices={slices} />
		</div>
	</main>
</Layout>

<script>
	window.addEventListener('DOMContentLoaded', () => {
		const container = document.querySelector('.grid-container')
		if (window.matchMedia('(prefers-reduced-motion: no-preference)')) {
			if (window.matchMedia('(pointer:fine')) {
				document.addEventListener('mousemove', event => {
					container.style.setProperty(
						'--mouseX',
						event.pageX / window.innerWidth
					)
					container.style.setProperty(
						'--mouseY',
						event.pageY / window.innerHeight
					)
				})
			}

			document.addEventListener('scroll', () => {
				container.style.setProperty(
					'--scroll',
					window.scrollY / window.innerHeight
				)
			})
		}
	})
</script>

<style lang='scss'>
	@mixin mouseParallax($multiplier) {
		@media (prefers-reduced-motion: no-preference) and (pointer: fine) {
			transform: translate(
				calc(#{$multiplier * 100px} * var(--mouseX)),
				calc(
					#{$multiplier * 100px} * var(--mouseY) + #{$multiplier * -1000px} *
						var(--scroll)
				)
			);
		}
		@media (prefers-reduced-motion: no-preference) and (pointer: coarse) {
			transform: translateY(calc(#{$multiplier * -1000px} * var(--scroll)));
		}
	}

	.grid-container {
		display: grid;
		place-items: center;
		--mouseX: 0.5;
		--mouseY: 0.5;
		--scroll: 0;
	}
	.slice-container {
		display: grid;
		background-color: hsla(223, 81%, 9%, 75%);
		padding: var(--space-m-xl);
		margin: var(--space-xs-s);
		gap: var(--space-2xl-3xl);
		border-radius: var(--space-s-m);
		max-width: 1136px;
		width: 100%;
	}

	.hero {
		--min: 50ch;
		--gap: 1rem;

		display: grid;
		grid-gap: var(--gap);
		grid-template-columns: repeat(auto-fit, minmax(min(100%, var(--min)), 1fr));
		max-width: 1136px;
		width: 100%;

		.hero-column {
			display: grid;
			gap: var(--space-xs);
			place-content: center;
			font-family: var(--header-font);
			padding-block: var(--space-2xl);
			margin-inline: auto;
			text-align: center;
			width: 100%;
			z-index: 1;
			> * {
				margin-block-start: 1.5rem;
			}
			.kicker {
				font-size: var(--step-0);
				margin-top: 0;

				.spacer {
					margin-inline: var(--space-2xs);
				}
			}
		}
	}

	.header-composition {
		position: relative;
		> * {
			position: absolute;
		}
		.present {
			top: 20.5%;
			left: 19%;
			z-index: 1;
			@include mouseParallax(0.5);
		}
		.bell {
			top: 58%;
			left: 27%;
			@include mouseParallax(0.25);
		}
		.cursor {
			top: 55%;
			left: 69%;
			z-index: 2;
			@include mouseParallax(0.7);
		}
		.hat {
			top: 32%;
			left: 69%;
			@include mouseParallax(0.4);
		}
		.keyboard {
			top: 6%;
			left: 44%;
			@include mouseParallax(0.2);
		}
		.sock {
			top: 26%;
			left: 0%;
			@include mouseParallax(0.35);
		}
	}

	.body-html {
		font-size: var(--step-1);
		line-height: var(--step-0);
		font-family: var(--body-font);
		font-weight: 400;
		color: var(--color-white);
		max-width: 30ch;
	}

	.cta {
		align-items: center;
		background: var(--hero-cta-background);
		border-radius: 3rem;
		color: var(--black);
		font-size: var(--step--1);
		display: none;
		font-family: var(--body-font);
		margin-inline: auto;
		padding-block: 0.25rem;
		padding-inline: 0.4rem;
		padding-inline-start: 0.75rem;
		width: fit-content;
		@media (min-width: 640px) {
			display: grid;
			grid-template-columns: 1fr fit-content(20ch);
		}
	}
	.cta-description {
		color: var(--white);
		padding-inline: 0.65rem;
		font-size: var(--step--2);
		font-weight: 600;
	}
</style>
