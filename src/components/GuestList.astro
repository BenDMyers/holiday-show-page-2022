---
import * as prismicH from "@prismicio/helpers";
import { getAllGuests } from "../lib/prismicio";
import GuestAvatar from "./GuestAvatar.astro";

const { heading, body } = Astro.props.primary;

// Fetch guests and map to order from CMS
const allGuests = await getAllGuests();

const bodyHTML = prismicH.asHTML(body);
---

<section>
  <h2>{heading}</h2>

  <Fragment set:html="bodyHTML" />

  <div>
    {
      allGuests.map((guest) => (
        <div>
          <h3>{guest.data.name}</h3>
          <GuestAvatar avatar={guest.data.avatar} guestName={guest.data.name} />

          <a href={`/guest/${guest.uid}`}>View Details</a>
        </div>
      ))
    }
  </div>
</section>
